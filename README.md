# FDF

这个 **FDF 项目** 旨在通过实现一个三维线框模型渲染器，帮助你掌握以下 **核心技能** 和 **图形编程知识**：

---

### **核心学习目标**
1. **图形库与窗口管理**
- 使用 **MiniLibX** 库创建窗口、处理用户输入（键盘/鼠标），掌握图形渲染的基本流程。
- 实现窗口的流畅管理（如关闭、缩放、最小化），确保资源释放无泄漏（`mlx_destroy_window`、`mlx_destroy_image`）。

2. **地图文件解析与数据结构**
- 解析 `.fdf` 文件格式，读取三维坐标数据（`x, y, z`），验证数据合法性（如非矩形地图需报错）。
- 将数据转换为网格结构（如二维数组或链表），存储每个点的高度和位置信息。

3. **等轴测投影与坐标变换**
- 实现等轴测投影算法，将三维坐标 `(x, y, z)` 转换为二维屏幕坐标 `(screen_x, screen_y)`。
- 应用数学公式（如旋转矩阵）完成坐标变换，支持基础的缩放、平移和旋转（Bonus）。

4. **线框渲染与图形绘制**
- 使用 Bresenham 算法绘制线段，连接相邻点以形成线框结构。
- 根据高度值（`z`）调整颜色梯度，增强地形可视化效果（如低海拔用绿色，高海拔用白色）。

5. **用户交互与动态效果**
- 处理键盘事件（如 `ESC` 退出、方向键平移、`+/-` 缩放、`R` 重置视图）。
- 实现 Bonus 功能：多投影模式（平行投影、透视投影）、模型旋转、动态视角切换。

6. **内存管理与健壮性**
- 动态分配内存存储地图数据，确保无泄漏（`malloc`/`free`）。
- 处理非法输入（如文件不存在、数据格式错误），输出 `Error\n` 并优雅退出。

---

### **关键技术点解析**
#### 1. 等轴测投影公式
```c
	// 等轴测投影转换
	screen_x = (x - y) * cos(30°);  
	screen_y = (x + y) * sin(30°) - z;
```
**关键点**：通过三角函数将三维坐标映射到二维平面，调整角度（如 30°）控制投影效果。

#### 2. Bresenham 直线算法
```c
	void	draw_line(t_point p1, t_point p2, t_image *img)
	{
		int dx = abs(p2.x - p1.x);
		int dy = -abs(p2.y - p1.y);
		int sx = p1.x < p2.x ? 1 : -1;
		int sy = p1.y < p2.y ? 1 : -1;
		int err = dx + dy;

		while (1)
		{
			put_pixel(img, p1.x, p1.y, calculate_color(p1.z, p2.z));
			if (p1.x == p2.x && p1.y == p2.y)
				break ;
			int e2 = 2 * err;
			if (e2 >= dy)
			{
				err += dy;
				p1.x += sx;
			}
			if (e2 <= dx)
			{
				err += dx;
				p1.y += sy;
			}
		}
	}
```
**关键点**：高效绘制线段，支持颜色插值（基于高度 `z` 值）。

#### 3. 地图解析（`.fdf` 文件）
```c
	// 读取文件并存储为网格
	t_map	*parse_map(char *filename)
	{
		int fd = open(filename, O_RDONLY);
		char *line;
		t_map *map = init_map();

		while ((line = get_next_line(fd)) != NULL)
		{
			int *row = parse_line(line); // 分割字符串为整数数组
			add_row_to_map(map, row);
			free(line);
		}
		close(fd);
		return map;
	}
```
**关键点**：使用 `get_next_line` 逐行读取，验证每行数据长度一致，确保地图为矩形。

---

### **工程实践与思维提升**
1. **模块化设计**
- 分离图形渲染（`render.c`）、地图解析（`parser.c`）、数学计算（`math_utils.c`）到独立模块。
- 使用头文件（如 `fdf.h`）定义结构体（`t_map`, `t_point`）和共享常量。

2. **防御式编程**
- 检查 `mlx_init()` 和 `mlx_new_window()` 返回值，处理图形库初始化失败。
- 使用 `valgrind` 检测内存泄漏，确保所有 `malloc` 均有对应的 `free`。

3. **性能优化**
- 预计算投影坐标，减少实时计算开销。
- 使用双缓冲技术（`mlx_new_image`）避免画面闪烁。

4. **测试策略**
- 测试不同地图（如平面、山脉、极端高度差），验证渲染正确性。
- 模拟用户输入（缩放、旋转），检查视图变换是否流畅。

---

### **项目隐喻与深层价值**
- **“线框模型是3D图形的基础”**：通过实现线框渲染，理解三维数据到二维屏幕的映射逻辑，为学习更复杂的3D渲染（如纹理贴图、光照模型）奠定基础。
- **“数学是图形编程的核心”**：掌握坐标变换、矩阵运算和几何算法，提升解决复杂问题的能力。
- **“从数据到可视化”**：学习如何将抽象数据（如高度图）转化为直观的图形表达，培养数据可视化思维。

---

### **通关要点**
1. **分步实现**
- 先完成地图解析和等轴测投影，再添加用户交互和Bonus功能。
- 使用简单地图（如 2x2 网格）调试基础渲染逻辑。

2. **错误处理全覆盖**  
- 处理文件读取错误（如 `perror("Error")`）、内存分配失败、无效用户输入。
- 确保所有错误路径释放资源，避免程序崩溃。

3. **扩展 Bonus 功能**
- 实现模型旋转（欧拉角或四元数），支持多轴控制（如 `X/Y/Z` 轴旋转）。
- 添加透视投影，使用视锥体裁剪和深度缓冲增强3D效果。

---

通过此项目，你将从“控制台开发者”进阶为“图形编程者”，掌握3D渲染的核心技术栈，为游戏开发、科学可视化等领域的深入探索奠定基础。
